<div>
    <app-header />
    <section
        class="bg-[url('/images/banner/shop.png')] h-[220px] mt-6 bg-cover bg-no-repeat relative bg-left"
    >
        <div class="absolute left-0 top-0 w-full h-full bg-[#2422228a]">
            <div
                class="w-[85%] md:w-[80%] sm:w-[90%] lg:w-[90%] h-full mx-auto"
            >
                <div
                    class="flex flex-col justify-center gap-1 items-center h-full w-full text-white"
                >
                    <h2 class="text-3xl font-bold">Shipping Page</h2>
                    <div
                        class="flex justify-center items-center gap-2 text-2xl w-full"
                    >
                        <a routerLink="/">Home</a>
                        <span class="pt-1">
                            <fa-icon [icon]="faChevronRight"></fa-icon>
                        </span>
                        <span>Shipping</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="bg-[#eeeeee]">
        <div class="w-[85%] lg:w-[90%] md:w-[90%] sm:w-[90%] mx-auto py-16">
            <div class="w-full flex flex-wrap">
                <div class="w-[67%] md-lg:w-full">
                    <div class="flex flex-col gap-3">
                        <div class="bg-white p-6 shadow-sm rounded-md">
                            <h2 class="text-slate-600 font-bold pb-3">
                                Shipping Information
                            </h2>
                            @if (!$res()) {
                            <form
                                [formGroup]="shippingForm"
                                (ngSubmit)="save()"
                            >
                                <div
                                    class="flex md:flex-col md:gap-2 w-full gap-5 text-slate-600"
                                >
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="name">Name</label>
                                        <input
                                            formControlName="name"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="name"
                                            placeholder="Name"
                                        />
                                    </div>
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="address">Address</label>
                                        <input
                                            formControlName="address"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="address"
                                            placeholder="Address"
                                        />
                                    </div>
                                </div>
                                <div
                                    class="flex md:flex-col md:gap-2 w-full gap-5 text-slate-600"
                                >
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="phone">Phone</label>
                                        <input
                                            formControlName="phone"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="phone"
                                            placeholder="Phone"
                                        />
                                    </div>
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="post">Post</label>
                                        <input
                                            formControlName="post"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="post"
                                            placeholder="Post"
                                        />
                                    </div>
                                </div>
                                <div
                                    class="flex md:flex-col md:gap-2 w-full gap-5 text-slate-600"
                                >
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="province">Province</label>
                                        <input
                                            formControlName="province"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="province"
                                            placeholder="Province"
                                        />
                                    </div>
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="city">City</label>
                                        <input
                                            formControlName="city"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="city"
                                            placeholder="City"
                                        />
                                    </div>
                                </div>
                                <div
                                    class="flex md:flex-col md:gap-2 w-full gap-5 text-slate-600"
                                >
                                    <div
                                        class="flex flex-col gap-1 mb-2 w-full"
                                    >
                                        <label for="area">Area</label>
                                        <input
                                            formControlName="area"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 outline-none focus:border-green-500 rounded-md"
                                            id="area"
                                            placeholder="Area"
                                        />
                                    </div>
                                    <div
                                        class="flex flex-col gap-1 mt-7 mb-2 w-full"
                                    >
                                        <button
                                            type="submit"
                                            class="px-3 py-[6px] rounded-sm hover:shadow-green-500/50 hover:shadow-lg bg-green-500 text-white"
                                            [disabled]="shippingForm.invalid"
                                        >
                                            Save Changes
                                        </button>
                                    </div>
                                </div>
                            </form>
                            } @if ($res()) {
                            <div class="flex flex-col gap-1">
                                <h2 class="text-slate-600 font-semibold pb-2">
                                    Deliver To
                                    {{ shippingForm.get("name")?.value }}
                                </h2>
                                <p>
                                    <span
                                        class="bg-blue-200 text-blue-800 text-sm font-medium mr-2 px-2 py-1 rounded"
                                    >
                                        Home
                                    </span>
                                    <span>
                                        {{ shippingForm.get("phone")?.value }}
                                        {{ shippingForm.get("address")?.value }}
                                        {{
                                            shippingForm.get("province")?.value
                                        }}
                                        {{ shippingForm.get("city")?.value }}
                                        {{ shippingForm.get("area")?.value }}
                                    </span>
                                    <span
                                        (click)="$res.set(false)"
                                        class="text-indigo-500 cursor-pointer"
                                    >
                                        Change
                                    </span>
                                </p>
                                <p class="text-slate-600 text-sm">
                                    Email To jdpachar&#64;yopmail.com
                                </p>
                            </div>
                            }
                        </div>
                        @for (p of $products(); track p.shopName;) {
                        <div class="flex bg-white p-4 flex-col gap-2">
                            <div class="flex justify-start items-center">
                                <h2 class="text-md text-slate-600 font-bold">
                                    {{ p.shopName }}
                                </h2>
                            </div>
                            <div
                                *ngFor="
                                    let product of p.products;
                                    trackBy: trackByFn
                                "
                                class="w-full flex flex-wrap"
                            >
                                <div class="flex sm:w-full gap-2 w-7/12">
                                    <div
                                        class="flex gap-2 justify-start items-center"
                                    >
                                        <img
                                            class="w-[80px] h-[80px]"
                                            [src]="
                                                product.productInfo.images[0]
                                            "
                                            alt=""
                                        />
                                        <div class="pr-4 text-slate-600">
                                            <h2 class="text-md font-semibold">
                                                {{ product.productInfo.name }}
                                            </h2>
                                            <span class="text-sm"
                                                >Brand:
                                                {{
                                                    product.productInfo.brand
                                                }}</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="flex justify-between w-5/12 sm:w-full sm:mt-3"
                                >
                                    <div class="pl-4 sm:pl-0">
                                        <h2 class="text-lg text-orange-500">
                                            {{
                                                product.productInfo.price
                                                    | appMathOperations
                                                        : "discount"
                                                        : product.productInfo
                                                              .discount
                                                    | currency
                                            }}
                                        </h2>
                                        <p class="line-through">
                                            {{
                                                product.productInfo.price
                                                    | currency
                                            }}
                                        </p>
                                        <p>
                                            -{{ product.productInfo.discount }}%
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        }
                    </div>
                </div>
                <div class="w-[33%] md-lg:w-full">
                    <div class="pl-3 md-lg:pl-0 md-lg:mt-5">
                        <div
                            class="bg-white p-3 text-slate-600 flex flex-col gap-3"
                        >
                            <h2 class="text-xl font-bold">Order Summary</h2>
                            <div class="flex justify-between items-center">
                                <span>Items Total ({{ $items() }})</span>
                                <span>{{ $price() | currency }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Delivery Fee</span>
                                <span>{{ $shippingFee() | currency }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Total Payment</span>
                                <span>{{
                                    $price() + $shippingFee() | currency
                                }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Total</span>
                                <span class="text-lg text-[#059473]">{{
                                    $price() + $shippingFee() | currency
                                }}</span>
                            </div>
                            <button
                                (click)="placeOrder()"
                                [disabled]="$res() ? false : true"
                                [ngClass]="$res() ? 'bg-red-500' : 'bg-red-300'"
                                class="px-5 py-[6px] rounded-sm hover:shadow-red-500/50 hover:shadow-lg text-sm text-white uppercase"
                            >
                                Place Order
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <app-footer />
</div>
